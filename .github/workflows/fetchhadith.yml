name: Fetch Daily Hadith

on:
  schedule:
    - cron: '0 * * * *' # Runs every hour
  workflow_dispatch: # Allows manual trigger of the workflow

jobs:
  fetch-hadith:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Fetch Daily Hadith and Save Response
      env:
        API_KEY: ${{ secrets.API_KEY }}
      run: |
        python - <<EOF
        import requests
        import json
        import os

        # API endpoint
        API_ENDPOINT = "https://api.sunnah.com/v1/hadiths/random"
        API_KEY = os.getenv("API_KEY")

        headers = {
            "x-api-key": API_KEY
        }

        response = requests.get(API_ENDPOINT, headers=headers)
        if response.status_code == 200:
            data = response.json()
            with open('dailyhadith.json', 'w') as json_file:
                json.dump(data, json_file, indent=4)
        else:
            print(f"Failed to fetch API: {response.status_code} - {response.text}")
        EOF

    - name: Commit and Push JSON File
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git add dailyhadith.json
        git commit -m "Update Daily Hadith (cron job)"
        git push
